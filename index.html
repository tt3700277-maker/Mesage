<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Admin Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff0055; --bg: #000; --card: #111; --border: #222; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; position: fixed; width: 100%; }
        .wrapper { display: flex; height: 100%; width: 100%; position: relative; }

        #sidebar { width: 100%; height: 100%; background: var(--bg); position: absolute; left: 0; transition: 0.3s; z-index: 10; display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        #sidebar.hidden { left: -100%; }

        .header { padding: 15px; background: var(--card); border-bottom: 1px solid var(--border); font-size: 14px; font-weight: 600; color: var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .clear-btn { background: #300; color: #f55; border: 1px solid #500; padding: 4px 8px; border-radius: 5px; font-size: 10px; cursor: pointer; }

        #userList { flex: 1; overflow-y: auto; padding: 10px; }
        .u-card { padding: 12px; border-radius: 8px; background: var(--card); margin-bottom: 8px; border: 1px solid var(--border); position: relative; }
        .u-del { position: absolute; right: 10px; top: 12px; color: #f55; font-size: 16px; }

        #chatMain { width: 100%; height: 100%; display: flex; flex-direction: column; background: #050505; position: absolute; right: -100%; transition: 0.3s; z-index: 20; }
        #chatMain.active { right: 0; }

        .chat-nav { padding: 10px 15px; background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        #msgBox { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 13px; }
        
        .m { max-width: 85%; padding: 8px 12px; border-radius: 12px; line-height: 1.4; position: relative; }
        .m.u { background: #222; align-self: flex-start; border-bottom-left-radius: 2px; }
        .m.a { background: var(--primary); align-self: flex-end; border-bottom-right-radius: 2px; }
        .m-del { font-size: 10px; color: #f55; margin-left: 10px; float: right; cursor: pointer; }

        .controls { padding: 10px; background: var(--card); border-top: 1px solid var(--border); }
        .reply-tag { background: #300; padding: 5px 10px; border-radius: 5px; font-size: 11px; margin-bottom: 8px; display: flex; justify-content: space-between; border: 1px solid #500; }
        .input-row { display: flex; gap: 8px; }
        input { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid var(--border); background: #000; color: #fff; outline: none; font-size: 13px; }
        button#sendBtn { padding: 0 18px; background: var(--primary); border: none; color: #fff; border-radius: 20px; font-weight: 600; font-size: 13px; }
    </style>
</head>
<body>

<div class="wrapper">
    <div id="sidebar">
        <div class="header">
            <span>CLIENT LIST</span>
            <button class="clear-btn" onclick="deleteAllData()">Clear All Data</button>
        </div>
        <div id="userList"></div>
    </div>

    <div id="chatMain">
        <div class="chat-nav">
            <button onclick="goBack()" style="background:none; border:none; color:#fff; font-size:20px;">‚Üê</button>
            <div id="activeTitle" style="font-size:13px; flex:1;">Chat</div>
        </div>
        <div id="msgBox"></div>
        <div class="controls">
            <div id="replyBar" class="reply-tag" style="display:none;">
                <span>Replying as: <b id="rName">None</b></span>
                <span onclick="cancelR()">Cancel</span>
            </div>
            <div class="input-row">
                <input type="text" id="replyInp" placeholder="Click message to reply...">
                <button id="sendBtn" onclick="send()">SEND</button>
            </div>
        </div>
    </div>
</div>

<script>
    const S_URL = 'https://rpxifsrlavmqhjtcezlv.supabase.co';
    const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJweGlmc3JsYXZtcWhqdGNlemx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzkxMDgsImV4cCI6MjA4MTQxNTEwOH0.uIsVuMypVVxU19cyzRw_c8Y964_fXx-uTA3C2kux6Rw';
    const supabaseClient = supabase.createClient(S_URL, S_KEY);

    let currentS = "", selectedP = "";

    async function getUsers() {
        const { data } = await supabaseClient.from('messages').select('sender_id').order('created_at', {ascending: false});
        if(!data) return;
        const unique = [...new Set(data.map(m => m.sender_id))];
        document.getElementById('userList').innerHTML = unique.map(uid => `
            <div class="u-card ${currentS===uid?'active':''}">
                <div onclick="sel('${uid}')"><b>üë§ ID: ${uid.slice(-6).toUpperCase()}</b></div>
                <div class="u-del" onclick="deleteUser('${uid}')">üóëÔ∏è</div>
            </div>`).join('');
    }

    function sel(uid) {
        currentS = uid;
        document.getElementById('sidebar').classList.add('hidden');
        document.getElementById('chatMain').classList.add('active');
        document.getElementById('activeTitle').innerText = "Client: " + uid.slice(-6).toUpperCase();
        load();
    }

    function goBack() {
        document.getElementById('sidebar').classList.remove('hidden');
        document.getElementById('chatMain').classList.remove('active');
    }

    async function load() {
        if(!currentS) return;
        const { data } = await supabaseClient.from('messages').select('*').eq('sender_id', currentS).order('created_at', { ascending: true });
        const box = document.getElementById('msgBox');
        box.innerHTML = (data || []).map(m => `
            <div class="m ${m.is_admin?'a':'u'}" onclick="${!m.is_admin ? `setR('${m.profile_id}')` : ''}">
                <span class="m-del" onclick="deleteMsg('${m.id}')">Delete</span>
                <small>${m.is_admin ? 'Girl: '+m.profile_id : 'Sent to: '+m.profile_id}</small>
                ${m.content}
            </div>`).join('');
        box.scrollTop = box.scrollHeight;
    }

    // --- Delete Functions ---

    async function deleteMsg(id) {
        if(confirm("‡¶è‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) {
            await supabaseClient.from('messages').delete().eq('id', id);
            load();
        }
    }

    async function deleteUser(uid) {
        if(confirm("‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) {
            await supabaseClient.from('messages').delete().eq('sender_id', uid);
            getUsers();
            if(currentS === uid) goBack();
        }
    }

    async function deleteAllData() {
        if(confirm("‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá ‡¶®‡¶æ‡•§")) {
            const { error } = await supabaseClient.from('messages').delete().neq('id', 0); // ‡¶°‡¶æ‡¶Æ‡¶ø ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶® ‡¶∏‡¶¨ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
            if(!error) {
                alert("‡¶∏‡¶¨ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                location.reload();
            }
        }
    }

    function setR(p) { selectedP = p; document.getElementById('replyBar').style.display = 'flex'; document.getElementById('rName').innerText = p; }
    function cancelR() { selectedP = ""; document.getElementById('replyBar').style.display = 'none'; }

    async function send() {
        const inp = document.getElementById('replyInp');
        if(!inp.value || !currentS || !selectedP) return;
        const text = inp.value; inp.value = "";
        await supabaseClient.from('messages').insert([{ sender_id: currentS, profile_id: selectedP, content: text, is_admin: true }]);
        load();
    }

    setInterval(getUsers, 5000);
    setInterval(load, 3000);
    getUsers();
</script>
</body>
</html>
